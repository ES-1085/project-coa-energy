---
title: "Project proposal"
author: "COA Energy, Sierra, Hunter, Laila"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
```

## 1. Introduction
  We plan on analyzing and interpreting the energy data set to make an assessment on how many gallons of fuel the school has used over a span of 9-10 years. We are curious about learning how much less emissions the school uses due to the newly installed insulation system. This will be found by calculating how much less oil the school is using, we will be able to calculate how much the school has decreased their CO2 emission. This data was collected by David Gibson. The data was collected through the yearly energy center analysis. This is a long term goal which is to make COA fossil free, net 0, by 2030. 
  Through this project we hope to evaluate whether or not the school is on track to meet that goal when it comes to energy use of buildings. Our variables include the date the fuel was purchased, the cost, the amount of fuel in gallons. The buildings we will focus on will be Turrets and Blair-Tyson, as well as Seafox and Davis. The dataset is not fully up to date with the effects of new heat system installations, nor will they be until the end of the year so this will not be a fully comprehensive analysis until those can updated. Although most effects from the transfer won't be visible yet, many systems are being fully transitioned into electric heating that is being funded by a newly constructed solar panel array outside of Bangor for green renewable energy. This means that the fossil fuel requirements will be reduced to zero for buildings that have undergone heat-pump installations or insulation. 
    We will work with the price requirements of fuel for multiple years of on campus buildings, as well as the price of heat pump and insulation installations. Using this, we plan to show a basic analysis on the saved fuel costs when compared to the overall price of the transition. 

## 2. Data

```{r Connecting Data}
library(readxl)
energy_use <- read_excel("../data/energy_use.xlsx", na = "NA")
glimpse(energy_use)
```

## 3. Ethics review

https://docs.google.com/spreadsheets/d/17HQLm0ieg3CpGigJwEUrePDcWNnYUJZW/edit#gid=570530532

## 3. Ethics review
  The biases that could effect our data visualizations and how the data was collected could be believing that the school has completely transformed their heating systems to electric from fossil fuels. We are aware that that is not the case. We are also aware that the fueled heaters were on for a part of the year that the school was not intending for. This is not able to be seen in the data because the fuel tanks are no longer receiving fuel refills. We also did not collect the data ourselves. This data was collected by David Gibson and others. 
  We do not need to worry about misrepresentation or misleading information when it comes to people, there would be no negative effects on people. However, creating incorrect data visualizations and interpretations would be confusing. 

## 4. Data analysis plan
  We will use variables such as gallons, we can calculate emissions, dates/time in years to see the difference overtime, we also plan on touching on pricing and how much money the school has saved over time. We will focus on the buildings on campus such as Blair-Tyson, Seafox, Davis and Turrets. We met with David Gibson and used the advice he shared with us throughout this process.
  We plan on making bar plots to visualize and analyze which buildings use the most fuel, and see how their fuel needs associated prices have changed overtime. We believe we will see the most effect from heat pump and insulation installation at Witchcliff, Seafox, Davis, and Blair-Tyson. We will use line graphs to show their fuel uses over long periods of time. Animations may also be able to show this change effectively due to the many years of data available. For finer analysis we can also facet wrap graphs side by side. 
  On top of this, we will analyze the effectiveness of different types of fuel, and if there is any visible differences according to total gallons used and amount of deliveries needed. 
  We will use variables such as gallons, we can calculate emissions, dates/time in years to see the difference overtime, we also plan on touching on pricing and how much money the school has saved over time.
  
Summary Statistics:

```{r Initial analysis graph}
ggplot(data = energy_use) +
geom_bar( mapping = aes(x = Building, fill = `Fuel Type` )) +
  coord_flip()
```

```{r}
energy_use %>%
  group_by(Building) %>%
  summarize(total_gallons = sum(Gallons, na.rm = FALSE)) %>% 
arrange(desc(total_gallons))
```

```{r}
energy_use %>%
count(Building, Gallons)

```

```{r Gallon for each Building}
energy_use %>%
  group_by(Building) %>%
  summarize(total_gals = sum(Gallons, na.rm = TRUE)) %>%
  drop_na() %>%
ggplot(aes(x = fct_reorder(Building, total_gals), y = total_gals)) +
         geom_col() +
         labs(title = "Gallons Used by Each Building", x = "Building", y = "Number of Gallons") +
  coord_flip()

```
```{r}
energy_use %>%
  group_by(Building) %>%
  summarize(total_gals = sum(Gallons, na.rm = TRUE)) %>%
  drop_na() %>%
ggplot(aes(x = fct_reorder(Building, total_gals), y = total_gals, )) +
         geom_col() +
  coord_flip()
#Messing around to
```


```{r Mutate-Turrets}
new_data <- energy_use %>%
   mutate(Building = case_when(Building %in% c("Turrets", "Turrets Annex") ~ "Turrets",
                            
                               TRUE ~ Building)) #%>%
  #distinct(Building)
```

```{r }
ggplot(data = energy_use) +
geom_bar( mapping = aes(x = Building, fill = `Gallons` )) +
  coord_flip()
```

```{r filter-Delivery Date}
new_energy_use %>%
  filter(between(`Delivery Date`, as.Date('2022-01-01'), as.Date('2023-01-01'))) 
```

Repeating yearly filter to compare multiple years- animation?

```{r}
install.packages("visdat")
library(visdat)
library(naniar)
```

```{r}
visdat::vis_dat(new_energy_use)
```
```{r faceted-lineplot-gallons-deliverydate}
new_data %>% 
 filter(Building %in% c("Turrets","Seafox", "Blair Tyson", "Davis Center" )) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
  ggplot() +
  geom_line(mapping = aes(x = Week, y = cumulative_Gallons, color = as.factor(Year)))+
  facet_wrap(~Building)
```


```{r filter-Delivery_Date}
energy_use %>%
  filter(between(`Delivery Date`, as.Date('2022-01-01'), as.Date('2023-01-01'))) 
```


```{r}
new_energy_use %>% 
 filter(Building %in% c("Turrets","Seafox", "Blair Tyson", "Davis Center" )) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  ggplot() +
  geom_line(mapping = aes(x = `Delivery Date`, y = Gallons, color = as.factor(Year))) +
  facet_wrap(~Building)
  
```

```{r}
new_data %>%
  group_by(`Delivery Date`, Building) %>% 
  summarise(across(c(Building, `Delivery Date`)))
```

```{r}
visdat::vis_miss(energy_use)
```

```{r}
naniar::gg_miss_var(energy_use)
```

``` {r new_energy_use}
new_energy_use <- new_data %>%
 mutate() %>%
select(-c(`...8`,`...9`,`...10`))
```

```{r missing_data}
new_energy_use %>%
  mutate(Building = case_when(Building == "NA" ~ NA,
                              TRUE ~ Building)) %>%
  drop_na(Building) %>%
ggplot(aes(x = Building,
           y = Gallons)) +
  geom_miss_point(alpha = 0.5)+
coord_flip()
```

``` {r}
new_energy_use %>%
  data = new_energy_use
  filter(Building == "Turrets")%>%
  select(c(`Fuel Type`, Gallons, Building)) %>%
   filter(Building %in% c("Turrets","Seafox", "Blair Tyson", "Davis Center" )) %>%
  sum(data$Gallons) %>%
  arrange(desc(Gallons))

```

``` {r yearly_fuel_data}
yearly_fuel_data = new_energy_use %>%
  mutate(Year = year(`Delivery Date`)) %>%
   group_by(Building, Year) %>% 
  summarize(total_gallons = sum(Gallons)) %>%
   filter(Building %in% c("Turrets","Seafox", "Blair Tyson", "Davis Center" ))
    ``` 
    
``` {r}
new_energy_use %>%
select(Building, Gallons) %>%
 filter(Building == "Turrets")%>%
 data <- rowSums( Building[Gallons] )
```

We should label our graphs and charts. We can put the important information in and the rest of what we were exploring later. When we present we will export the charts/graphs. 


```{r Turrets_Linegraphs}
new_energy_use %>% 
 filter(Building %in% c("Turrets")) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
  ggplot() +
  geom_line(mapping = aes(x = Week, y = cumulative_Gallons, color = as.factor(Year)))+
  facet_wrap(~Year)
```
```{r Davis_Center_Linegraphs}
new_energy_use %>% 
 filter(Building %in% c("Davis Center")) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
  ggplot() +
  geom_line(mapping = aes(x = Week, y = cumulative_Gallons, color = as.factor(Year)))+
  facet_wrap(~Year)
```

```{r Blair_Tyson_Linegraph}
new_energy_use %>% 
 filter(Building %in% c("Blair Tyson")) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
  ggplot() +
  geom_line(mapping = aes(x = Week, y = cumulative_Gallons, color = as.factor(Year)))+
  facet_wrap(~Year)
```

```{r Seafox_Linegraph}
new_energy_use %>% 
 filter(Building %in% c("Seafox")) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
  ggplot() +
  geom_line(mapping = aes(x = Week, y = cumulative_Gallons, color = as.factor(Year)))+
  facet_wrap(~Year)
```




```{r Davis_Center_Fueluse}
new_energy_use %>% 
  filter(Building %in% c("Davis Center")) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
  ggplot() +
  geom_col(mapping = aes(x = Year, y = cumulative_Gallons, color = "Fuel Type"))
```

```{r}
new_energy_use %>% 
 filter(Building %in% c("Turrets","Seafox", "Blair Tyson", "Davis Center" )) %>%
  select(Building , Gallons, `Delivery Date`) %>%
  arrange(`Delivery Date`) %>%
  mutate(Year = year(`Delivery Date`),
         Month = month(`Delivery Date`),
         Week = week(`Delivery Date`)) %>%
  drop_na(Gallons) %>%
  group_by(Building, Week, Year) %>% 
  summarize(Gallons = sum(Gallons, na.rm = T),
            cumulative_Gallons = cumsum(Gallons)) %>%
ggplot() + 
  geom_col(aes(x = Building, y = cumulative_Gallons, color = "Fuel Type")) 

```
